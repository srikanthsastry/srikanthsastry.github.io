<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <link rel="alternate" type="application/atom+xml" title="Srikanth Sastry" href="/feed.xml">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      'Privatize' your classes for better unit testing &middot; Srikanth Sastry
    
  </title>

  
  <link rel="canonical" href="//srikanth.sastry.name/privatize-your-classes-for-better-unit-testing/">
  

  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/poole.css">
  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/syntax.css">
  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="//srikanth.sastry.name/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="//srikanth.sastry.name/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="//srikanth.sastry.name/atom.xml">

  
</head>


  <body class="sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A personal website</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="//srikanth.sastry.name/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/archives/">Archives</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/publications/">Publications</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/touchstone-radio-episodes/">Touchstone Radio Episodes</a>
        
      
    
    <!-- <a class="sidebar-nav-item" href="/archive/v1.1.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span> -->
  </nav>
  <div class="sidebar-item">
  <p>
  <a class="navbar-item" href="/feed.xml" target="_blank">Feed</a>
  </p>
  </div>
  <div class="sidebar-item">
    <p>
      &copy; 2023. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Srikanth Sastry</a>
            <small>A Techie in Boston</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">'Privatize' your classes for better unit testing</h1>
  <span class="post-date">11 Jul 2022</span>
  <p><img src="images/amber-iceberg-under-water.jpg" alt="" />
You service may be massive, but it’s public API surface is pretty small; it has just a handful of APIs/endpoints. Everything else behind those APIs are ‘private’ and ‘implementation details’. It is highly advisable to follow this pattern even when designing the implementation of your service, almost like a fractal. This will pay dividends in the quality of your test suite.</p>

<p>For instance, you service implementation should be split into ‘modules’ where each module has a well defined API through which other modules interact with it. This API boundary has to be strict. Avoid the temptation of breaking this abstraction because your module need this ‘one tiny bit’ of information that is available inside the implementation of another module. You will regret breaking encapsulation, I guarantee it!</p>

<p>If you follow this pattern, you will eventually reach a class that has a public API, has all of its external/shared dependencies shared, and delegates a lot of it’s business logic and complex computation to multiple ‘private’ classes that are practically hermetic and have no external/shared dependencies. At this point, treat all these ‘private’ classes as, well, private. That is, DO NOT WRITE UNIT TESTS FOR SUCH CLASSES!</p>

<p>Yes, that statement seems to fly in the face of all things sane about software testing, but it is a sane statement, nonetheless. These private classes should be tested indirectly via unit tests for the public class that they serve/support. This will make your tests a lot more accurate. Let me explain.</p>

<p>Say, you have a public class <code class="language-plaintext highlighter-rouge">CallMe</code> and it uses a private class <code class="language-plaintext highlighter-rouge">HideMe</code>, and furthermore, <code class="language-plaintext highlighter-rouge">HideMe</code> is used only by <code class="language-plaintext highlighter-rouge">CallMe</code>, and the software design enforces this restriction. Assume that both <code class="language-plaintext highlighter-rouge">CallMe</code> and <code class="language-plaintext highlighter-rouge">HideMe</code> have their own unit tests, and the tests do an excellent job. At this point, there is a new requirement that necessitates that we refactor <code class="language-plaintext highlighter-rouge">CallMe</code>’s implementation, and as part of that refactoring, we need to modify the API contract between <code class="language-plaintext highlighter-rouge">CallMe</code> and <code class="language-plaintext highlighter-rouge">HideMe</code>. Since <code class="language-plaintext highlighter-rouge">HideMe</code>’s only  caller is <code class="language-plaintext highlighter-rouge">CallMe</code>, it is completely safe to treat this API contract as an implementation detail and modify it as we see fit. Since we are modifying the specification of <code class="language-plaintext highlighter-rouge">HideMe</code>, we have to change the tests for <code class="language-plaintext highlighter-rouge">HideMe</code> as well.</p>

<p>Now, you run the tests, and the tests for <code class="language-plaintext highlighter-rouge">HideMe</code> fail. What information does that give you? Does that mean that there is a bug in <code class="language-plaintext highlighter-rouge">HideMe</code>; or does it mean that we did not modify the tests correctly? You cannot determine this until you either manually inspect <code class="language-plaintext highlighter-rouge">HideMe</code>’s test code, or until you run the tests for <code class="language-plaintext highlighter-rouge">CallMe</code>. If <code class="language-plaintext highlighter-rouge">CallMe</code>’s tests fail, then (since this is a refactoring diff) there must be a bug in <code class="language-plaintext highlighter-rouge">HideMe</code> and/or <code class="language-plaintext highlighter-rouge">CallMe</code>, but if the tests don’t fail, then it must be an issue in <code class="language-plaintext highlighter-rouge">HideMe</code>’s tests.</p>

<p>Thus, it turns out that the failure in <code class="language-plaintext highlighter-rouge">HideMe</code> tests gives you no additional information compared to failure in <code class="language-plaintext highlighter-rouge">CallMe</code>’s tests. Thus, tests for <code class="language-plaintext highlighter-rouge">HideMe</code> have zero benefits and a non-zero maintenance cost! In other words, testing <code class="language-plaintext highlighter-rouge">HideMe</code> directly is useless!</p>

<p>By aggressively refactoring your code to push as much of you logic into private classes, you are limiting the API surface of your software that needs direct testing, and simultaneously, ensuring that your tests suite is not too large, has very <a href="/unit-test-attributes-and-their-trade-offs/">high accuracy, with reasonable completeness</a>.</p>

</div>




      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
