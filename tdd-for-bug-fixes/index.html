<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <link rel="alternate" type="application/atom+xml" title="Srikanth Sastry" href="/feed.xml">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      TDD for Bug Fixes &middot; Srikanth Sastry
    
  </title>

  
  <link rel="canonical" href="//srikanth.sastry.name/tdd-for-bug-fixes/">
  

  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/poole.css">
  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/syntax.css">
  <link rel="stylesheet" href="//srikanth.sastry.name/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="//srikanth.sastry.name/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="//srikanth.sastry.name/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="//srikanth.sastry.name/atom.xml">

  
</head>


  <body class="sidebar-overlay theme-base-08">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A personal website</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="//srikanth.sastry.name/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/about/">About</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/archives/">Archives</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/publications/">Publications</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="//srikanth.sastry.name/touchstone-radio-episodes/">Touchstone Radio Episodes</a>
        
      
    
    <!-- <a class="sidebar-nav-item" href="/archive/v1.1.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.1.0</span> -->
  </nav>
  <div class="sidebar-item">
  <p>
  <a class="navbar-item" href="/feed.xml" target="_blank">Feed</a>
  </p>
  </div>
  <div class="sidebar-item">
    <p>
      &copy; 2025. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Srikanth Sastry</a>
            <small>A Techie in Boston</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">TDD for Bug Fixes</h1>
  <span class="post-date">11 Jun 2025</span>
  <p><img src="/images/bug-stabbing-software-engineer-in-the-back.png" alt="" /></p>

<p>I have seen way too many ‚Äòsenior‚Äô engineers get bug fixing wrong. It is common to see an engineer sent a pull request titled ‚Äúbug fix: <something>" and the PR has changes to the functional code that fixes the bug and a correspond test case that shows that the bug is fixed. If that sounds reasonable, THINK AGAIN ‚Äî you‚Äôve walked right into the classic trap!</something></p>

<p><strong>If you are sending PRs for bug fixes with functional code change and an added test case in the same PR/commit, then you are doing it wrong!</strong></p>

<p>The crux of the problem is the following: HOW DO YOU <em>KNOW</em> YOU‚ÄôRE SMASHING THAT BUG? HOW CAN YOU BE SURE YOUR TEST ISN‚ÄôT A DUD?! Your answer better not be <em>VIBE CHECKS</em> or just <em>STARING REALLY HARD</em>! If you are having to deploy your entire service/library and run an end-to-end test to demonstrate correctness, then you are doing too much, and you still haven‚Äôt demonstrated that the unit test actually captures the previously errneous behavior.</p>

<p>There is this shiny little concept called <a href="https://en.wikipedia.org/wiki/Test-driven_development">Test Driven Development (TDD)</a> that is mighty useful here. You can peruse the wikipedia link to figure out what TDD is exactly. This note will show you how to use TDD for bug fixes.</p>

<p>Here are simple steps to fixing bugs using TDD:</p>

<ol>
  <li>
    <p>üïµÔ∏è Discover the bug. BAM! There it is! Your nemesis!</p>
  </li>
  <li>
    <p>üß™ Create a PR that creates a new unit test that exposes the unit test. YAWZA!</p>
  </li>
  <li>
    <p>üîß Create a second PR on top the first PR that makes the functional code change and changes the expectation on the unit test accordingly. That should squash the bug! KAPOW!</p>
  </li>
  <li>
    <p>üí∞ Justice is served! PROFIT!</p>
  </li>
</ol>

<p><img src="/images/tdd-bug-lifecycle.png" alt="" /></p>

<p>Still not sure? Let‚Äôs demonstrate this with an example. Say, there is a bug that you discovered and know how to fix it.</p>

<p>First, you create a PR that demonstrates the bug by invoking your SUT with the offending input, and sets the expected value to be <em>incorrect</em> so that the test case actually <em>passes</em> with this incorrect value; thus demonstrating the bug.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TestSUT</span><span class="p">(</span><span class="n">unittest</span><span class="p">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="bp">...</span>
    <span class="k">def</span> <span class="nf">test_bug_b12345</span><span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">None</span><span class="p">:</span>
        <span class="sh">'''</span><span class="s">
        Test to expose bug b12345
        </span><span class="sh">'''</span>
        <span class="c1"># Arrange
</span>        <span class="n">sut</span> <span class="o">=</span> <span class="nc">SUT</span><span class="p">(...)</span>
        
        <span class="c1"># Act
</span>        <span class="n">actual</span> <span class="o">=</span> <span class="n">sut</span><span class="p">.</span><span class="nf">test_method</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="sh">"</span><span class="s">bad-input</span><span class="sh">"</span><span class="p">)</span>

        <span class="c1"># Assert
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">assertEqual</span><span class="p">(</span><span class="n">actual</span><span class="p">,</span> <span class="sh">"</span><span class="s">bad buggy output</span><span class="sh">"</span><span class="p">)</span>
        <span class="c1"># The assertion above demonstartes the bug b12345
</span>        <span class="c1"># The right expected value should be "correct output".
</span>        <span class="c1"># self.assertEqual(actual, "correct output")
</span>        
</code></pre></div></div>

<p>You can send that PR out for review and merge it in. Now you have a solid proof that you have found a bug, and reproduced it.</p>

<p>Next, you have a new PR that fixes that bug. If you bug fix is correct, then the test <code class="language-plaintext highlighter-rouge">test_bug_b12345</code> should not start failing. The output of <code class="language-plaintext highlighter-rouge">sut.test_method(input="bad-input")</code> should be <code class="language-plaintext highlighter-rouge">"correct output"</code> and not <code class="language-plaintext highlighter-rouge">"bad buggy output"</code>. So, you now modify the unit test <code class="language-plaintext highlighter-rouge">test_bug_b12345</code> in that same PR that looks as follows:</p>
<div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    def test_bug_b12345(self) -&gt; None:
        '''
        Test to expose bug b12345
        '''
        # Arrange
        sut = SUT(...)
        
        # Act
        actual = sut.test_method(input="bad-input")
<span class="err">
</span>        # Assert
<span class="gd">-       self.assertEqual(actual, "bad buggy output")
-       # The assertion above demonstartes the bug b12345
-       # The right expected value should be "correct output".
-       # self.assertEqual(actual, "correct output")
</span><span class="gi">+       self.assertEqual(actual, "correct output")
</span></code></pre></div></div>

<p>Now your test should pass. This second PR is conclusive proof that your diff now fixes the bug! So, merge it in. Deploy with confidence. <strong>BOOM ‚Äî PROFIT!</strong></p>

</div>




      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
